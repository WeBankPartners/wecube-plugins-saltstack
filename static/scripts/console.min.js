(function(o){"use strict";"function"==typeof define&&(define.amd||define.cmd)?define(["jquery"],o):o("undefined"!=typeof jQuery?jQuery:window.Zepto)})(function(o){"use strict";o.extend({LogOut:function(){location.href="/console/logout?rnd="+Math.random()}}),o.fn.ConsoleLogin=function(n){void 0===n&&(n={});var e,i,t,r,s,d,a=this;e=o(void 0===n.loginBoxMsg?"#loginBoxMsg":n.loginBoxMsg),i=o(void 0===n.username?"#username":n.username),t=o(void 0===n.userpwd?"#userpwd":n.userpwd),s=o(void 0===n.src_vmaddr?"#src_vmaddr":n.src_vmaddr),d=o(void 0===n.dst_vmaddr?"#dst_vmaddr":n.dst_vmaddr),r=void 0!==n.standalone&&n.standalone,i.focus();var l=function(o){e.html(o),e.show()},c=null;if(a.bind("form-pre-serialize",function(o,n,e,i){c=t.val()}),r===!0){var u=function(n){o.post("/console/chksshdaddr?rnd="+Math.random(),{vm_addr:n.val()},function(n){console.log("data:",n);var e=n;"object"!=typeof n&&(e=o.parseJSON(n)),e.ok&&(console.log(e.data.sshd_addr),d.val(e.data.sshd_addr))})};s.unbind("keyup").keyup(function(n){u(o(this))}),s.unbind("paste").bind("paste",function(n){u(o(this))}),s.unbind("blur").blur(function(n){u(o(this))})}a.ajaxForm({dataType:"json",beforeSubmit:function(o,n,d){if(e.hide(),r===!0){if(0===s.val().length)return s.focus(),l("请输入主机地址"),!1;var a=url.parse(s.val());if(void 0===a.host||void 0===a.port)return s.focus(),l("请输入正确的主机地址"),!1}return 0===i.val().length?(t.val(c),i.focus(),l("请输入您用户名"),!1):0===t.val().length?(t.val(c),i.focus(),l("请输入您的密码"),!1):void 0},success:function(n){var e=n;"object"!=typeof n&&(e=o.parseJSON(n)),e.ok?location.href=e.data:(t.focus(),t.select(),l(e.msg))}})},o.fn.OpenTerminal=function(n){void 0===n&&(n={});var e,i=this;e=void 0===n.wsaddr?"ws://127.0.0.1:8080/console":n.wsaddr;var t=function(n,e,i){var t=o("#c-appbar").height(),r=o(window).height(),s=(o(window).width(),r-t-10);o(".terminal").height(s),n.resize(e,i)},r=function(){function n(){var n=o("<span>",{text:"qwertyuiopasdfghjklzxcvbnm"});i.append(n);var e=n.css("line-height");e=e.substr(0,e.length-2);var t={width:n.width()/22,height:n.height()-e/2.8};return n.remove(),t}function e(){var n=o("#c-appbar").height(),e=o(window).height(),i=o(window).width()-20,t=e-n-26;return{width:i,height:t}}var t=n(),r=e();return{cols:Math.floor(r.width/t.width),rows:Math.floor(r.height/t.height)-5}};window.WebSocket=window.WebSocket||window.MozWebSocket;var s=r().cols,d=r().rows,a=null,l=new WebSocket(e+"?cols="+s+"&rows="+d);Terminal.applyAddon(fit),Terminal.applyAddon(attach),l.onopen=function(){a=new Terminal({termName:"xterm",cols:s,rows:d,useStyle:!0,convertEol:!0,screenKeys:!0,cursorBlink:!1,visualBell:!0,colors:Terminal.xtermColors}),console.log(a),a.attach(l),a._initialized=!0,a.open(i.get(0)),a.fit(),t(a,s,d),o(window).resize(function(){t(a,s,d)}),a.on("title",function(n){o(document).prop("title",n)}),window.term=a,window.socket=l},l.onclose=function(n){a.destroy();var e=o("<span></span>");e.text("网络中断（与服务器端连接已断开，请重新连接或联系管理员）。"),e.css({display:"inline-block",position:"absolute","z-index":1500,top:"40%",width:"100%","text-align":"center",color:"#FFFFFF"}),e.appendTo(i)},l.onerror=function(o){console.log("Socket error:",o)}},o.fn.loading=function(n){void 0===n&&(n={});var e,i,t=this;e=void 0===n.text?"Loading...":n.text,i=void 0===n.ico_class?"mif-spinner4 mif-3x mif-ani-spin fg-green":n.ico_class;var r=o('<div><i class="'+i+'"></i> '+e+"</div>");t.html(""),t.css({position:"relative"}),t.append(r),o(r).css({display:"inline-block",position:"absolute","z-index":1500,top:"40%",left:"45%"})}});