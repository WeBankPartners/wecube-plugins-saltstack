!function(o){"use strict";"function"==typeof define&&(define.amd||define.cmd)?define(["jquery"],o):o("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(u){"use strict";u.extend({LogOut:function(){location.href="/console/logout?rnd="+Math.random()}}),u.fn.ConsoleLogin=function(o){void 0===o&&(o={});var t,s,r,d,a,e;t=void 0===o.loginBoxMsg?u("#loginBoxMsg"):u(o.loginBoxMsg),s=void 0===o.username?u("#username"):u(o.username),r=void 0===o.userpwd?u("#userpwd"):u(o.userpwd),a=void 0===o.src_vmaddr?u("#src_vmaddr"):u(o.src_vmaddr),e=void 0===o.dst_vmaddr?u("#dst_vmaddr"):u(o.dst_vmaddr),d=void 0!==o.standalone&&o.standalone,s.focus();function l(o){t.html(o),t.show()}var c=null;if(this.bind("form-pre-serialize",function(o,n,e,i){c=r.val()}),!0===d){var n=function(o){u.post("/console/chksshdaddr?rnd="+Math.random(),{vm_addr:o.val()},function(o){console.log("data:",o);var n=o;"object"!=typeof o&&(n=u.parseJSON(o)),n.ok&&(console.log(n.data.sshd_addr),e.val(n.data.sshd_addr))})};a.unbind("keyup").keyup(function(o){n(u(this))}),a.unbind("paste").bind("paste",function(o){n(u(this))}),a.unbind("blur").blur(function(o){n(u(this))})}this.ajaxForm({dataType:"json",beforeSubmit:function(o,n,e){if(t.hide(),!0===d){if(0===a.val().length)return a.focus(),l("请输入主机地址"),!1;var i=url.parse(a.val());if(void 0===i.host||void 0===i.port)return a.focus(),l("请输入正确的主机地址"),!1}return 0===s.val().length?(r.val(c),s.focus(),l("请输入您用户名"),!1):0===r.val().length?(r.val(c),s.focus(),l("请输入您的密码"),!1):void 0},success:function(o){var n=o;"object"!=typeof o&&(n=u.parseJSON(o)),n.ok?location.href=n.data:(r.focus(),r.select(),l(n.msg))}})},u.fn.OpenTerminal=function(o){void 0===o&&(o={});var n,t=this;n=void 0===o.wsaddr?"ws://127.0.0.1:8080/console":o.wsaddr;function e(o,n,e){var i=u("#c-appbar").height(),t=u(window).height(),s=(u(window).width(),t-i-30);u(".terminal").height(s),o.resize(n,e)}function i(){var o,n,e=function(){var o=u("<span>",{text:"qwertyuiopasdfghjklzxcvbnm"});t.append(o);var n=o.css("line-height");n=n.substr(0,n.length-2);var e={width:o.width()/22,height:o.height()-n/2.8};return o.remove(),e}(),i=(o=u("#c-appbar").height(),n=u(window).height(),{width:u(window).width()-20,height:n-o-30});return{cols:Math.floor(i.width/e.width),rows:Math.floor(i.height/e.height)-5}}window.WebSocket=window.WebSocket||window.MozWebSocket;var s=i().cols,r=i().rows,d=null;console.log(n),console.log(n+"&cols="+s+"&rows="+r);var a=new WebSocket(n+"&cols="+s+"&rows="+r);Terminal.applyAddon(fit),Terminal.applyAddon(attach),a.onopen=function(){d=new Terminal({termName:"xterm",cols:s,rows:r,useStyle:!0,convertEol:!0,screenKeys:!0,cursorBlink:!1,visualBell:!0,colors:Terminal.xtermColors}),console.log(d),d.attach(a),d._initialized=!0,d.open(t.get(0)),d.fit(),e(d,s,r),u(window).resize(function(){e(d,s,r)}),d.on("title",function(o){u(document).prop("title",o)}),window.term=d,window.socket=a},a.onclose=function(o){d.destroy();var n=u("<span></span>");n.text("网络中断（与服务器端连接已断开，请重新连接或联系管理员）。"),n.css({display:"inline-block",position:"absolute","z-index":1500,top:"40%",width:"100%","text-align":"center",color:"#FFFFFF"}),n.appendTo(t)},a.onerror=function(o){console.log("Socket error:",o)}},u.fn.loading=function(o){void 0===o&&(o={});var n,e;n=void 0===o.text?"Loading...":o.text,e=void 0===o.ico_class?"mif-spinner4 mif-3x mif-ani-spin fg-green":o.ico_class;var i=u('<div><i class="'+e+'"></i> '+n+"</div>");this.html(""),this.css({position:"relative"}),this.append(i),u(i).css({display:"inline-block",position:"absolute","z-index":1500,top:"40%",left:"45%"})}});
